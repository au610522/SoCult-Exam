---
title: "Running the ABM"
author: "Josephine S Brunsgaard"
date: "5/4/2020"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
library(pacman)
p_load(tidyverse, 
       dplyr,
       tibble,
       brms)

p_load(truncnorm, patchwork)


setwd("~/Social and cultural dynamics in Cognition/SoCult-Exam/Exam")

```

## What to do

Remember to run the functions in ABM SocKult Functions
Weights are already saved

```{r Groups}
#Create a list with the groups


g1 <- c(5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5) # all in the middle
g2 <- c(5, 2, 5, 5, 4, 6, 6, 5, 6, 6 ,4, 5, 5, 6, 7, 4, 5, 4, 3, 5, 6, 6, 5, 5, 4, 6, 6, 4) # mean of 5, sd of 1.08
g3 <- c(6, 6, 5, 3, 4, 10, 1, 4, 6, 7, 4, 4, 2, 4, 8, 5, 7, 3, 9, 5, 3, 5, 5, 2, 8, 7, 2, 5) # rnorm - sd 2.2
g4 <-c(1, 1, 1, 2, 2, 2, 3, 3, 3,4, 4, 4, 4, 5,5, 5, 5, 6, 6,6 ,7, 7, 8, 8,9, 9, 10, 10) #mean = 5, most with low expertise, uniform, sd = 2.7
g5 <- c(1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,9,9,9,9,9,9,9,9,9,9,9,10, 10) # no middle, bimodal sd: 3.9

sd(g5)

groups <- cbind(g1,g2, g3, g4, g5)

```

##

```{r Running the function}
set.seed(100, kind=NULL, normal.kind = NULL)
d <- simulation(N = 28, rounds = 10, max_points_pr_round = 10, groups = groups,n_groups = 5, sim_pr_group = 100)

write.csv(d, "data.csv")
```


## Cleaning the data 

```{r}
d$group_type <- as.character(d$group_type)
d$sim_nr <- as.character(d$sim_nr)
d$round <- as.numeric(d$round)
d$current_points <- as.numeric(d$current_points)
d$expertise_level_start <- factor(d$expertise_level_start, levels = c("low", "mid", "high", "top"))
d$expertise_level <- as.character(d$expertise_level)

d$change_exp_points <- d$current_points - d$prev_points - d$start_points
```


## PLOTS 

```{r Hypothesis 1}

# H1: Groups with a more diverse distribution of expertise points will have an overall better outcome. We would therefore expect the groups with the highest standard deviation to perform the best.

####### USING THE FOLLOWIN PLOT ! #############

# plot 1: 
subset_1 <- d %>% 
  group_by(group_type, round) %>%
  summarize("mean_current_points" = mean(current_points))
  
plot_1 <- ggplot(subset_1, aes(round, mean_current_points, color = group_type)) + geom_line() + scale_x_discrete(name ="Round", 
                    limits=c("1","2","3", "4", "5", "6","7","8", "9", "10")) + 
  ylab("Mean current points") + 
  ggtitle("Development of Points Within Group Types Over Rounds") + 
  ylim(0,100) + 
  labs(col = "Group Type")


#plot 2: 

subset_2 <- d %>% 
  group_by(round, expertise_level_start, group_type) %>% 
  summarize("mean_current_points" = mean(current_points))

plot_2 <- ggplot(subset_2,aes(x=round,y=mean_current_points))+
  geom_point(aes(shape = expertise_level_start, color = group_type)) +
  scale_x_discrete(name ="Round", 
                    limits=c("1","2","3", "4", "5", "6","7","8", "9", "10")) + 
  ylab("Mean current points") + 
  ggtitle("Development of Points Within Group Types and Expertise Level Over Rounds") + 
  ylim(0,100) +
  labs(shape = "Stating level of expertise") +
  labs(col = "Group type")


plot_1 + plot_2



#plot 3:

subset_3a <- d %>% 
  subset(group_type == 1)

subset_3b <- d %>% 
  subset(group_type == 2)

subset_3c <- d %>% 
  subset(group_type == 3)

subset_3d <- d %>% 
  subset(group_type == 4)

subset_3e <- d %>% 
  subset(group_type == 5)


plot_3a <- ggplot(subset_3a,aes(x=round,y=current_points))+
  geom_point(aes(col = expertise_level_start))+ 
  geom_smooth() + geom_errorbar(stat = "summary", fun.data = mean_se)


plot_3b <- ggplot(subset_3b,aes(x=round,y=current_points))+
  geom_point(aes(col = expertise_level_start))+ 
  geom_smooth() + geom_errorbar(stat = "summary", fun.data = mean_se)

plot_3c <- ggplot(subset_3c,aes(x=round,y=current_points))+
  geom_point(aes(col = expertise_level_start))+ 
  geom_smooth() + geom_errorbar(stat = "summary", fun.data = mean_se)

plot_3d <- ggplot(subset_3d,aes(x=round,y=current_points))+
  geom_point(aes(col = expertise_level_start))+ 
  geom_smooth() + geom_errorbar(stat = "summary", fun.data = mean_se)

plot_3e <- ggplot(subset_3e,aes(x=round,y=current_points))+
  geom_point(aes(col = expertise_level_start))+ 
  geom_smooth() + geom_errorbar(stat = "summary", fun.data = mean_se)


plot_3a + plot_3b + plot_3c + plot_3d + plot_3e



############### A PLOT WE ARE GOING TO USE! ######################

plot_3x <- ggplot(d,aes(x=round,y=current_points, col = expertise_level_start))+
  geom_point(stat = "summary", fun.data = mean_se)+ 
  geom_smooth(stat = "summary", fun.data = mean_se) + 
    scale_x_discrete(name ="Round", 
                    limits=c("1","2","3", "4", "5", "6","7","8", "9", "10")) + 
  ylab("Mean current points pr agent") + 
  ggtitle("Development of Points Within Group Types and Expertise Level") + 
  ylim(0,100) +
  labs(col = "Level of expertise at the start of the simulation") +
  theme(legend.position="top") +
  facet_grid(~group_type)

plot_3x

```

```{r Hypothesis 2}

p_1 <- ggplot(d,aes(x=round,y=change_exp_points, col = expertise_level_start))+
  geom_point(stat = "summary", fun.data = mean_se)+ 
  geom_smooth(stat = "summary", fun.data = mean_se) + 
      scale_x_discrete(name ="Round", 
                    limits=c("1","2","3", "4", "5", "6","7","8", "9", "10")) + 
  ylab("Change in expertise points") + 
  ggtitle("Change in expertise points compared the previous round") + 
  labs(col = "Level of expertise at the start of the simulation") +
  theme(legend.position="top") +
  facet_grid(~group_type)

p_1 

p_2 <- ggplot(d,aes(x=round,y=change_exp_points, col = expertise_level_start))+
  geom_point(stat = "summary", fun.data = mean_se)+ 
  geom_smooth(stat = "summary", fun.data = mean_se)  
  

p_2
```

```{r}
sub_1 <- d %>% 
  group_by(round, group_type, expertise_level) %>% 
  count(expertise_level)

sub_1$expertise_level <- factor(sub_1$expertise_level, levels = c("low", "mid", "high", "top"))


pl_1 <- ggplot(sub_1,aes(x=round, y=n, col = group_type)) +
  geom_bar(stat = "summary",fun.y=mean, position="dodge")

pl_2 <- ggplot(sub_1, aes(x=round, y=n, fill=expertise_level)) +
  geom_bar(stat = "summary",fun.y=mean, position="dodge") +
  facet_wrap( ~ group_type) ## FInd new colors 
  


```

